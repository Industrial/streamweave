---
description: Ensure direnv is loaded for all commands in this project
alwaysApply: true
globs: bin/**/*, .cursor/**/*
---

# Direnv Setup for StreamWeave

**CRITICAL**: This project uses `devenv` which requires `direnv` to be loaded for all build commands to work correctly.

## Required Setup

**Before running ANY command in this project**, you MUST source the direnv environment:

```bash
source .cursor/shell-init.sh && <your-command>
```

Or use the wrapper:

```bash
source .cursor/ensure-direnv.sh && <your-command>
```

## Why This Is Needed

The project uses `devenv` with a `.envrc` file that provides:
- OpenSSL (required for Kafka feature)
- cmake (required for librdkafka)
- pkg-config (required for finding libraries)
- All other development dependencies defined in `devenv.nix`

Without direnv loaded, commands like `bin/check`, `bin/build`, etc. will fail with missing dependency errors.

## Verification

After sourcing the script, verify dependencies are available:
```bash
which cmake          # Should find cmake in Nix store
which pkg-config      # Should find pkg-config in Nix store
pkg-config --exists openssl && echo "âœ… OpenSSL found"
```

## Files

- `.cursor/shell-init.sh` - Main script that loads direnv
- `.cursor/ensure-direnv.sh` - Wrapper that sources shell-init.sh
- `.cursor/README.md` - Detailed documentation

## Rule Enforcement

When executing terminal commands, ALWAYS prefix them with:
```bash
source .cursor/shell-init.sh && 
```

Example:
```bash
source .cursor/shell-init.sh && bin/check
source .cursor/shell-init.sh && cargo build --all-features
```

This ensures the devenv environment is always available.
