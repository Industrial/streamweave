---
description: Performance optimization guidelines for StreamWeave
alwaysApply: true
---

# Performance Guidelines

## Memory Management
- Prefer `Box<dyn Trait>` over generics when dynamic dispatch is needed
- Use `Pin<Box<dyn Stream>>` for pinned streams
- Avoid unnecessary allocations in hot paths
- Use `Cow<str>` for string operations that might not need allocation

## Async Performance
- Use `tokio::spawn` for CPU-intensive work
- Prefer `futures::stream::iter` for small collections
- Use `async-stream` for complex stream implementations
- Handle backpressure with appropriate buffering strategies

## Stream Processing
- Use `StreamExt` methods when possible (map, filter, etc.)
- Implement proper backpressure handling
- Use `RateLimit` transformer for controlled throughput
- Consider `Batch` transformer for reducing per-item overhead

## Compilation
- Use `cargo check` for fast compilation feedback
- Use `cargo build --release` for performance testing
- Consider `cargo llvm-cov` for coverage analysis
- Use `cargo nextest` for parallel test execution

## Profiling
- Use `tracing` for structured logging
- Profile with `cargo flamegraph` for CPU profiling
- Use `cargo llvm-cov` for coverage analysis
- Monitor memory usage with appropriate tools