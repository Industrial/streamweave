#!/usr/bin/env bash
# Publish packages in dependency order

set -euo pipefail
exec > >(tee log/publish.log) 2>&1 

echo "> publish"

for pkg in $(ls packages); do
    echo "> publish > publishing $pkg"
    if ! cargo publish -p "streamweave-$pkg"; then
        echo "> publish > failed to publish $pkg, skipping"
        continue
    fi
    echo "> publish > published $pkg"
done

echo "> publish > done"
