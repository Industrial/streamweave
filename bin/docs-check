#!/usr/bin/env bash
set -euo pipefail
exec > >(tee log/docs-check.log) 2>&1

echo "üìö Checking documentation..."
echo ""

# Capture output and exit code
DOC_OUTPUT=$(cargo doc --all-features --no-deps 2>&1)
DOC_EXIT=$?

# Check if documentation build failed completely
if [ $DOC_EXIT -ne 0 ]; then
  echo "$DOC_OUTPUT"
  echo ""
  echo "‚ùå Documentation check failed: cargo doc build failed!"
  exit 1
fi

# Check for missing documentation warnings
if echo "$DOC_OUTPUT" | grep -qi 'warning.*missing'; then
  echo "$DOC_OUTPUT"
  echo ""
  echo "‚ùå Documentation check failed: Missing documentation warnings found!"
  echo "   Please add missing documentation or add #[allow(missing_docs)] where appropriate."
  exit 1
fi

echo "$DOC_OUTPUT"
echo ""
echo "‚úÖ Documentation check passed: No missing documentation warnings found!"
exit 0

